from operator import sub

# When aspect ratio is unspecified, the builtin get_aspect returns 'auto'. This function actually calculates the aspect ratio directly
# https://stackoverflow.com/questions/41597177/get-aspect-ratio-of-axes
def get_aspect(ax):
    # Total figure size
    figW, figH = ax.get_figure().get_size_inches()
    # Axis size on figure
    _, _, w, h = ax.get_position().bounds
    # Ratio of display units
    disp_ratio = (figH * h) / (figW * w)
    # Ratio of data units
    # Negative over negative because of the order of subtraction
    data_ratio = sub(*ax.get_ylim()) / sub(*ax.get_xlim())

    return disp_ratio / data_ratio